openapi: 3.0.3
info:
  title: Hotel Booking System API
  description: |
    ระบบจองโรงแรมและที่พัก - RESTful API Documentation
    
    ## Overview
    ระบบนี้ถูกออกแบบมาเพื่อจัดการการจองโรงแรมแบบครบวงจร รองรับผู้ใช้งาน 4 บทบาท:
    - **Guest**: ผู้เข้าพัก - ค้นหาและจองห้องพัก
    - **Receptionist**: พนักงานต้อนรับ - จัดการ check-in/check-out
    - **Housekeeper**: แม่บ้าน - จัดการการทำความสะอาดห้อง
    - **Manager**: ผู้จัดการ - จัดการราคา สต็อก และรายงาน
    
    ## Authentication
    ระบบใช้ JWT (JSON Web Token) สำหรับการยืนยันตัวตน
    - ลงทะเบียนหรือเข้าสู่ระบบเพื่อรับ access token
    - ใส่ token ใน Authorization header: `Bearer <token>`
    
    ## Rate Limiting
    - Auth endpoints: 5 requests/minute
    - Search endpoints: 20 requests/minute
    - Booking endpoints: 10 requests/minute
    - General endpoints: 100 requests/minute
    
  version: 1.0.0
  contact:
    name: Hotel Booking System Support
    email: support@hotelbooking.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080
    description: Development server
  - url: http://localhost:8080/api
    description: Development API server

tags:
  - name: health
    description: Health check endpoints
  - name: auth
    description: Authentication and user management
  - name: rooms
    description: Room search and management
  - name: bookings
    description: Booking management
  - name: checkin
    description: Check-in operations (Receptionist only)
  - name: checkout
    description: Check-out operations (Receptionist only)
  - name: housekeeping
    description: Housekeeping operations (Housekeeper only)
  - name: pricing
    description: Pricing management (Manager only)
  - name: inventory
    description: Inventory management (Manager only)
  - name: policies
    description: Policy management (Manager only)
  - name: vouchers
    description: Voucher management
  - name: reports
    description: Reports and analytics (Manager only)
  - name: admin
    description: Administrative operations (Manager only)

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from login endpoint

  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          example: "Error message"
    
    Success:
      type: object
      properties:
        message:
          type: string
          example: "Operation successful"
    
    # Auth Models
    RegisterRequest:
      type: object
      required:
        - email
        - password
        - firstName
        - lastName
        - phone
      properties:
        email:
          type: string
          format: email
          example: "guest@example.com"
        password:
          type: string
          format: password
          minLength: 8
          example: "SecurePass123!"
        firstName:
          type: string
          example: "สมชาย"
        lastName:
          type: string
          example: "ใจดี"
        phone:
          type: string
          example: "0812345678"
    
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "guest@example.com"
        password:
          type: string
          format: password
          example: "SecurePass123!"
    
    LoginResponse:
      type: object
      properties:
        guestId:
          type: integer
          example: 1
        email:
          type: string
          example: "guest@example.com"
        firstName:
          type: string
          example: "สมชาย"
        lastName:
          type: string
          example: "ใจดี"
        role:
          type: string
          enum: [guest, receptionist, housekeeper, manager]
          example: "guest"
        accessToken:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    
    Guest:
      type: object
      properties:
        guestId:
          type: integer
          example: 1
        firstName:
          type: string
          example: "สมชาย"
        lastName:
          type: string
          example: "ใจดี"
        email:
          type: string
          example: "guest@example.com"
        phone:
          type: string
          example: "0812345678"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    
    UpdateProfileRequest:
      type: object
      properties:
        firstName:
          type: string
          example: "สมชาย"
        lastName:
          type: string
          example: "ใจดี"
        phone:
          type: string
          example: "0812345678"
    
    # Room Models
    RoomType:
      type: object
      properties:
        roomTypeId:
          type: integer
          example: 1
        name:
          type: string
          example: "Deluxe Room"
        description:
          type: string
          example: "ห้องพักหรูพร้อมวิวทะเล"
        maxOccupancy:
          type: integer
          example: 2
        defaultAllotment:
          type: integer
          example: 10
        amenities:
          type: array
          items:
            $ref: '#/components/schemas/Amenity'
        images:
          type: array
          items:
            type: string
          example: ["/images/deluxe-1.jpg", "/images/deluxe-2.jpg"]
        basePrice:
          type: number
          format: decimal
          example: 2500.00
    
    Amenity:
      type: object
      properties:
        amenityId:
          type: integer
          example: 1
        name:
          type: string
          example: "WiFi"
    
    SearchRoomsRequest:
      type: object
      required:
        - checkIn
        - checkOut
        - guests
      properties:
        checkIn:
          type: string
          format: date
          example: "2025-12-01"
        checkOut:
          type: string
          format: date
          example: "2025-12-05"
        guests:
          type: integer
          minimum: 1
          example: 2
    
    SearchRoomsResponse:
      type: object
      properties:
        availableRooms:
          type: array
          items:
            $ref: '#/components/schemas/RoomType'
        checkIn:
          type: string
          format: date
        checkOut:
          type: string
          format: date
        nights:
          type: integer
          example: 4
    
    # Booking Models
    CreateBookingHoldRequest:
      type: object
      required:
        - sessionId
        - roomTypeId
        - checkIn
        - checkOut
      properties:
        sessionId:
          type: string
          example: "sess_abc123xyz"
        guestAccountId:
          type: integer
          nullable: true
          example: 1
        roomTypeId:
          type: integer
          example: 1
        checkIn:
          type: string
          format: date
          example: "2025-12-01"
        checkOut:
          type: string
          format: date
          example: "2025-12-05"
    
    CreateBookingHoldResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "สร้าง hold สำเร็จ"
        holdId:
          type: integer
          example: 123
        holdExpiry:
          type: string
          format: date-time
          example: "2025-11-03T14:30:00Z"
    
    CreateBookingRequest:
      type: object
      required:
        - sessionId
        - bookingDetails
        - guests
      properties:
        sessionId:
          type: string
          example: "sess_abc123xyz"
        voucherCode:
          type: string
          nullable: true
          example: "SUMMER2025"
        bookingDetails:
          type: array
          items:
            $ref: '#/components/schemas/BookingDetail'
        guests:
          type: array
          items:
            $ref: '#/components/schemas/BookingGuest'
    
    BookingDetail:
      type: object
      required:
        - roomTypeId
        - ratePlanId
        - checkInDate
        - checkOutDate
        - numGuests
      properties:
        roomTypeId:
          type: integer
          example: 1
        ratePlanId:
          type: integer
          example: 1
        checkInDate:
          type: string
          format: date
          example: "2025-12-01"
        checkOutDate:
          type: string
          format: date
          example: "2025-12-05"
        numGuests:
          type: integer
          example: 2
    
    BookingGuest:
      type: object
      required:
        - firstName
        - type
      properties:
        firstName:
          type: string
          example: "สมชาย"
        lastName:
          type: string
          example: "ใจดี"
        type:
          type: string
          enum: [Adult, Child]
          example: "Adult"
        isPrimary:
          type: boolean
          example: true
    
    Booking:
      type: object
      properties:
        bookingId:
          type: integer
          example: 1
        guestId:
          type: integer
          example: 1
        totalAmount:
          type: number
          format: decimal
          example: 10000.00
        status:
          type: string
          enum: [PendingPayment, Confirmed, CheckedIn, Completed, Cancelled, NoShow]
          example: "Confirmed"
        policyName:
          type: string
          example: "Standard Cancellation Policy"
        policyDescription:
          type: string
          example: "ยกเลิกฟรีก่อน 7 วัน"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        details:
          type: array
          items:
            $ref: '#/components/schemas/BookingDetailResponse'
    
    BookingDetailResponse:
      type: object
      properties:
        bookingDetailId:
          type: integer
          example: 1
        roomTypeId:
          type: integer
          example: 1
        roomTypeName:
          type: string
          example: "Deluxe Room"
        checkInDate:
          type: string
          format: date
        checkOutDate:
          type: string
          format: date
        numGuests:
          type: integer
          example: 2
        roomNumber:
          type: string
          nullable: true
          example: "101"

paths:
  # Health Check Endpoints
  /health:
    get:
      tags:
        - health
      summary: Health check
      description: Check if the API is running
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                  message:
                    type: string
                    example: "Hotel Booking System API is running"

  /health/db:
    get:
      tags:
        - health
      summary: Database health check
      description: Check database connection and pool statistics
      responses:
        '200':
          description: Database is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                  total_conns:
                    type: integer
                    example: 10
                  idle_conns:
                    type: integer
                    example: 8
                  acquired_conns:
                    type: integer
                    example: 2
        '500':
          description: Database connection failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Auth Endpoints
  /api/auth/register:
    post:
      tags:
        - auth
      summary: Register a new guest
      description: Create a new guest account with email and password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              email: "newguest@example.com"
              password: "SecurePass123!"
              firstName: "สมชาย"
              lastName: "ใจดี"
              phone: "0812345678"
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Validation error or email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                emailExists:
                  value:
                    error: "อีเมลนี้ถูกลงทะเบียนแล้ว"
                validationError:
                  value:
                    error: "Invalid email format"

  /api/auth/login:
    post:
      tags:
        - auth
      summary: Login
      description: Authenticate with email and password to receive JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: "guest@example.com"
              password: "SecurePass123!"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "อีเมลหรือรหัสผ่านไม่ถูกต้อง"

  /api/auth/me:
    get:
      tags:
        - auth
      summary: Get current user profile
      description: Retrieve the authenticated user's profile information
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Guest'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Guest not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/auth/profile:
    put:
      tags:
        - auth
      summary: Update user profile
      description: Update the authenticated user's profile information
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Guest'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Room Endpoints
  /api/rooms/search:
    get:
      tags:
        - rooms
      summary: Search available rooms
      description: Search for available rooms based on check-in/check-out dates and number of guests
      parameters:
        - name: checkIn
          in: query
          required: true
          schema:
            type: string
            format: date
          example: "2025-12-01"
        - name: checkOut
          in: query
          required: true
          schema:
            type: string
            format: date
          example: "2025-12-05"
        - name: guests
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
          example: 2
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchRoomsResponse'
        '400':
          description: Invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidDate:
                  value:
                    error: "รูปแบบวันที่ check-in ไม่ถูกต้อง"
                pastDate:
                  value:
                    error: "วันที่ check-in ต้องไม่อยู่ในอดีต"

  /api/rooms/types:
    get:
      tags:
        - rooms
      summary: Get all room types
      description: Retrieve a list of all available room types
      responses:
        '200':
          description: List of room types
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RoomType'

  /api/rooms/types/{id}:
    get:
      tags:
        - rooms
      summary: Get room type by ID
      description: Retrieve detailed information about a specific room type
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        '200':
          description: Room type details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomType'
        '404':
          description: Room type not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/rooms/types/{id}/pricing:
    get:
      tags:
        - rooms
      summary: Get room type pricing
      description: Calculate pricing for a specific room type for given dates
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
        - name: checkIn
          in: query
          required: true
          schema:
            type: string
            format: date
          example: "2025-12-01"
        - name: checkOut
          in: query
          required: true
          schema:
            type: string
            format: date
          example: "2025-12-05"
      responses:
        '200':
          description: Pricing information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomType'
        '404':
          description: Room type not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/rooms/status:
    get:
      tags:
        - rooms
      summary: Get room status dashboard
      description: Get all rooms with their current occupancy and housekeeping status (Receptionist only)
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Room status dashboard
          content:
            application/json:
              schema:
                type: object
                properties:
                  rooms:
                    type: array
                    items:
                      type: object
                      properties:
                        roomId:
                          type: integer
                        roomNumber:
                          type: string
                        roomTypeName:
                          type: string
                        occupancyStatus:
                          type: string
                        housekeepingStatus:
                          type: string
                        guestName:
                          type: string
                          nullable: true
                        checkOutDate:
                          type: string
                          format: date
                          nullable: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - Receptionist role required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Booking Endpoints
  /api/bookings/hold:
    post:
      tags:
        - bookings
      summary: Create booking hold
      description: Create a temporary hold on room inventory (15 minutes)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBookingHoldRequest'
            example:
              sessionId: "sess_abc123xyz"
              roomTypeId: 1
              checkIn: "2025-12-01"
              checkOut: "2025-12-05"
      responses:
        '200':
          description: Hold created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateBookingHoldResponse'
        '400':
          description: Room not available
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "ห้องไม่ว่างแล้ว กรุณาเลือกห้องอื่น"

  /api/bookings:
    post:
      tags:
        - bookings
      summary: Create booking
      description: Create a new booking (requires authentication)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBookingRequest'
      responses:
        '201':
          description: Booking created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    
    get:
      tags:
        - bookings
      summary: Get user bookings
      description: Retrieve all bookings for the authenticated user
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [PendingPayment, Confirmed, CheckedIn, Completed, Cancelled, NoShow]
          description: Filter by booking status
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          description: Number of results to return
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
          description: Number of results to skip
      responses:
        '200':
          description: List of bookings
          content:
            application/json:
              schema:
                type: object
                properties:
                  bookings:
                    type: array
                    items:
                      $ref: '#/components/schemas/Booking'
                  total:
                    type: integer
                    example: 10

  /api/bookings/{id}:
    get:
      tags:
        - bookings
      summary: Get booking by ID
      description: Retrieve detailed information about a specific booking
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        '200':
          description: Booking details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'
        '403':
          description: Forbidden - Not your booking
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Booking not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bookings/{id}/confirm:
    post:
      tags:
        - bookings
      summary: Confirm booking
      description: Confirm a pending booking after payment
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                paymentMethod:
                  type: string
                  example: "credit_card"
      responses:
        '200':
          description: Booking confirmed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "ยืนยันการจองสำเร็จ"
        '400':
          description: Cannot confirm booking
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/bookings/{id}/cancel:
    post:
      tags:
        - bookings
      summary: Cancel booking
      description: Cancel a confirmed or pending booking
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  example: "Change of plans"
      responses:
        '200':
          description: Booking cancelled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "ยกเลิกการจองสำเร็จ"
                  refundAmount:
                    type: number
                    format: decimal
                    example: 8000.00
